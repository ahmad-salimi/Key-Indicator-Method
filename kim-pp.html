<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>KIM-PP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
  <style>
    /* ---------------------- CSS Variables ---------------------- */
    :root {
      --primary-color: #007bff;
      --secondary-color: #6c757d;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --card-border: #e9ecef;
      --text-color: #212529;
      --spacing: 16px;
      --border-radius: 8px;
    }

    /* ---------------------- Base Styles ---------------------- */
    body {
      font-family: Vazirmatn, Tahoma, sans-serif;
      direction: rtl;
      text-align: right;
      max-width: 1000px;
      margin: 24px auto;
      color: var(--text-color);
      background-color: var(--bg-color);
      padding: 0 var(--spacing);
      line-height: 1.6;
    }
    h2 {
      text-align: center;
      margin-bottom: 24px;
      color: var(--primary-color);
      font-size: 1.8em;
    }
    h3 {
      margin: 0 0 16px;
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 8px;
      font-size: 1.3em;
    }

    /* ---------------------- Form Elements ---------------------- */
    .card {
      border: 1px solid var(--card-border);
      border-radius: var(--border-radius);
      padding: var(--spacing);
      margin-bottom: 24px;
      background: var(--card-bg);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); 
    }
    
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: var(--spacing);
      margin-bottom: var(--spacing);
    }
    .date-row {
      display: flex;
      gap: 8px; 
    }
    .date-row select {
      flex: 1; 
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 10px 12px;
      font-family: inherit;
      border: 1px solid #ced4da;
      border-radius: 4px;
      box-sizing: border-box;
      transition: border-color 0.3s;
    }
    
    /* ---------------------- Responsive Table Consistency ---------------------- */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      display: block; 
      overflow-x: auto; 
      table-layout: fixed; 
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: right;
      vertical-align: middle;
      white-space: normal; 
    }
    th {
      background: #e9ecef;
      text-align: center;
      font-weight: bold;
      color: var(--text-color);
    }
    
    /* ---------------------- New Selection Styles ---------------------- */
    .selectable-cell {
      cursor: pointer;
      transition: background-color 0.2s, box-shadow 0.2s, color 0.2s, opacity 0.2s;
      user-select: none;
    }

    /* Hover effect for generic cells */
    .selectable-cell:hover:not(.selected):not(.temp-disabled) {
        background-color: #f0f8ff; 
    }
    /* Disabled state (Used only for Path Constraint logic) */
    .selectable-cell.temp-disabled {
        cursor: not-allowed;
        background-color: #f7f7f7 !important;
        color: #999;
        opacity: 0.7; 
    }
    /* Selected state (Eye-catching style) */
    .selectable-cell.selected {
        background-color: #e9f5ff !important; 
        box-shadow: 0 0 0 3px var(--primary-color) inset;
        font-weight: bold;
    }
    
    /* 1. Device Table (Step 2) */
    .device-table th, .device-table td {
        width: 10%;
        text-align: center;
    }
    .device-table .device-cell {
        height: 200px; 
        padding: 5px;
    }
    .device-image {
        max-width: 100%;
        max-height: 120px; 
        height: auto;
        border: none;
        border-radius: 4px;
        object-fit: contain;
        margin-bottom: 5px;
        display: block; 
        margin-left: auto;
        margin-right: auto;
    }

    /* 2. Path Table (Step 3) - Path part */
    .path-score-table th:nth-child(1), .path-score-table td:nth-child(1) { width: 40%; }
    .path-score-table th:nth-child(2), .path-score-table td:nth-child(2),
    .path-score-table th:nth-child(3), .path-score-table td:nth-child(3),
    .path-score-table th:nth-child(4), .path-score-table td:nth-child(4) { 
        width: 20%; 
        text-align: center; 
        background-color: var(--card-bg); 
    }
    .path-col-header {
        height: 80px; 
        background-color: var(--card-bg); 
        padding: 5px;
    }
    .path-col-header img {
        height: 70px; 
        width: auto;
        border: 1px solid #ccc;
        border-radius: 4px;
        object-fit: contain;
        background-color: white;
    }
    .path-score-table td {
        min-height: 60px; 
    }

    /* 3. Single Column Score Tables (Steps 3, 4, 5, 7) */
    .one-column-score-table th:nth-child(1), .one-column-score-table td:nth-child(1) { width: 80%; }
    .one-column-score-table th:nth-child(2), .one-column-score-table td:nth-child(2) { width: 20%; text-align: center; }

    /* 4. Horizontal Score Tables (Step 1) */
    .horizontal-score-table {
        table-layout: auto; 
        min-width: 100%;
    }
    .horizontal-score-table thead th {
        width: auto; 
        padding: 8px 5px;
    }
    .horizontal-score-table td {
        text-align: center;
        min-width: 40px;
    }
    .horizontal-score-table .label-cell {
        font-weight: bold;
        background-color: #f0f8ff; 
        min-width: 80px;
    }
    .horizontal-score-table td.selectable-cell {
        padding: 8px 5px;
        min-width: 50px;
    }

    /* 5. Posture Table (Step 6) - 3 columns now */
    .three-column-score-table-posture th:nth-child(1), .three-column-score-table-posture td:nth-child(1) { width: 15%; } 
    .three-column-score-table-posture th:nth-child(2), .three-column-score-table-posture td:nth-child(2) { width: 65%; } 
    .three-column-score-table-posture th:nth-child(3), .three-column-score-table-posture td:nth-child(3) { width: 20%; text-align: center; } 
    
    .posture-image {
        max-height: 100%; 
        max-width: 100%;
        height: auto;
        width: auto; 
        border: 1px solid #ddd;
        border-radius: 4px;
        object-fit: contain;
        margin: 0; 
    }
    .posture-image-cell {
        padding: 70px 10px; 
    }

    /* 6. Summary Table */
    #riskTable th, #riskTable td { white-space: normal; }
    
    /* ---------------------- Score Box ---------------------- */
    .score-box {
      font-weight: bold;
      font-size: 1.2em;
      margin-top: 16px;
      padding: 15px;
      background-color: #e9f5ff; 
      border: 2px solid #cce5ff;
      border-radius: var(--border-radius);
      text-align: center;
      color: var(--primary-color);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    /* ---------------------- Risk Table Highlighting ---------------------- */
    #riskTable .risk-low { background-color: #00cc44; }     
    #riskTable .risk-slight { background-color: #ffff66; }   
    #riskTable .risk-high { background-color: #ff9933; }    
    #riskTable .risk-very-high { background-color: #ff3333; } 

    /* ---------------------- Print Button ---------------------- */
    .print-section {
      text-align: center;
      margin: 30px 0;
    }
    
    .print-btn {
      background: linear-gradient(135deg, #007bff, #0056b3);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1em;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
      font-family: Vazirmatn, Tahoma, sans-serif;
    }
    
    .print-btn:hover {
      background: linear-gradient(135deg, #0056b3, #004085);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
    }
    
    .print-btn:active {
      transform: translateY(0);
    }

    /* ---------------------- Print Styles (OPTIMIZED FOR DENSITY) ---------------------- */
    @media print {
      /* ØªØºÛŒÛŒØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¯Ø± Ù¾Ø±ÛŒÙ†Øª */
      * {
          -webkit-print-color-adjust: exact !important; 
          print-color-adjust: exact !important;
      }

      body * {
        visibility: hidden;
      }
      
      .print-header,
      .print-header *,
      #step8,
      #step9,
      #step8 *,
      #step9 * {
        visibility: visible;
      }
      
      .print-header,
      #step8,
      #step9 {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      
      .print-header {
        text-align: center;
        border-bottom: 2px solid #007bff; /* thinner border */
        padding-bottom: 10px; /* reduced padding */
        margin-bottom: 10px; /* reduced margin */
      }
      
      .print-header h2 {
        color: #007bff;
        margin-bottom: 5px; /* reduced margin */
        font-size: 20px; /* reduced font size */
      }
      
      .card {
        border: 1px solid #333; /* thinner border */
        box-shadow: none;
        margin-bottom: 10px; /* reduced margin */
        page-break-inside: avoid;
      }
      
      .print-btn {
        display: none;
      }
      
      table {
        page-break-inside: avoid;
      }

      th, td {
          padding: 5px; /* Reduced cell padding */
      }
      
      body {
        margin: 5px; /* Reduced margin */
        padding: 5px; /* Reduced padding */
        font-size: 12px; /* Significantly reduced font size for density */
      }
      
      /* Ensure step 8 and 9 content is visible and dense */
      #step8, #step9 {
          font-size: 13px; /* Slightly bigger font for the content itself */
          padding: 5px;
          margin-top: 10px;
      }

      /* Risk Table specific optimization */
      #riskTable th, #riskTable td {
          font-size: 11px; /* Smallest font for the large risk table */
      }
      #riskTable th:nth-child(4) { 
          width: 35%; /* Allocate enough space for probability/consequences */
      }
    }
  
#riskTable .risk-low      { background-color:#00cc44 !important; }
#riskTable .risk-slight   { background-color:#aeea00 !important; }
#riskTable .risk-high     { background-color:#ff9933 !important; }
#riskTable .risk-very-high{ background-color:#ff3333 !important; }
.tbl-head, .tbl-label, .tbl-val { border:1px solid #333; padding:6px 8px; }
.tbl-label { font-weight:bold; }
.total { background:#f0f0f0; }
.final { background:#e9f5ff; color:#007bff; }
</style>
</head>
<body>
<h2>
    Ø±ÙˆØ´ Ø´Ø§Ø®Øµ Ú©Ù„ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¨Ø§Ø± Ú©Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ ÙˆØ¸Ø§ÛŒÙ Ù‡Ù„ Ø¯Ø§Ø¯Ù† Ùˆ Ú©Ø´ÛŒØ¯Ù† Ø¯Ø³ØªÛŒ Ø¨Ø§Ø±
    <br>
    KIM-PP
</h2>
  <button id="resetForm" style="margin-bottom:20px;padding:10px 20px;font-weight:bold;">Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙØ±Ù…</button>

  <div class="card">
    <h3>Ù…Ø´Ø®ØµØ§Øª</h3>
    <div class="row">
      <div>
        <label>Ù…Ø­Ù„ Ú©Ø§Ø± / ÙØ¹Ø§Ù„ÛŒØª ÙØ±Ø¹ÛŒ:</label>
        <input id="location" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù†Ø¨Ø§Ø± Ø¨Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ - Ø®Ø· Û²" type="text">
      </div>
      <div>
        <label>Ø§Ø±Ø²ÛŒØ§Ø¨:</label>
        <input id="evaluator" placeholder="Ù†Ø§Ù… Ø§Ø±Ø²ÛŒØ§Ø¨" type="text">
      </div>
    </div>
    
    <div class="row">
      <div>
        <label>Ù…Ø¯Øª Ø²Ù…Ø§Ù† Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ (Ø³Ø§Ø¹Øª):</label>
        <input id="workday" type="number" min="1" step="0.5" placeholder="Ù…Ø«Ù„Ø§Ù‹ 8">
      </div>
      <div>
        <label>Ù…Ø¯Øª Ø²Ù…Ø§Ù† ÙØ¹Ø§Ù„ÛŒØª ÙØ±Ø¹ÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡):</label>
        <input id="subtaskDuration" type="number" min="0" step="1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 45">
      </div>
      <div style="grid-column: span 1 / auto;">
        <label>ØªØ§Ø±ÛŒØ® (Ø´Ù…Ø³ÛŒ):</label>
        <div class="date-row">
          <select id="year"><option value="">Ø³Ø§Ù„</option></select>
          <select id="month"><option value="">Ù…Ø§Ù‡</option></select>
          <select id="day"><option value="">Ø±ÙˆØ²</option></select>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ø§ÙˆÙ„: ØªØ¹ÛŒÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø²Ù…Ø§Ù† (Ø¶Ø±ÛŒØ¨ Ù†Ù‡Ø§ÛŒÛŒ)</h3>
    <div class="inline">
      <label><input type="radio" name="mode" value="distance" checked> Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ§ØµÙ„Ù‡ (Ù…ØªØ±)</label>
      <label><input type="radio" name="mode" value="duration"> Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø¯Øª Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
    </div>

    <div id="distanceWrap" style="margin-top:10px;">
        <h4>Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ§ØµÙ„Ù‡ (Ù…ØªØ±)</h4>
        <table class="horizontal-score-table">
            <thead>
                <tr>
                    <th class="label-cell">ÙØ§ØµÙ„Ù‡ (Ù…ØªØ±)</th>
                    <th>ØªØ§ 40</th><th>ØªØ§ 200</th><th>ØªØ§ 400</th><th>ØªØ§ 800</th><th>ØªØ§ 1200</th><th>ØªØ§ 1800</th><th>ØªØ§ 2500</th><th>ØªØ§ 4200</th><th>ØªØ§ 6300</th><th>ØªØ§ 8400</th><th>ØªØ§ 11000</th><th>ØªØ§ 15000</th><th>ØªØ§ 20000</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="label-cell">Ø§Ù…ØªÛŒØ§Ø²</td>
                    <td data-score="1" class="selectable-cell single-select" data-group="time-distance">1</td>
                    <td data-score="1.5" class="selectable-cell single-select" data-group="time-distance">1.5</td>
                    <td data-score="2" class="selectable-cell single-select" data-group="time-distance">2</td>
                    <td data-score="2.5" class="selectable-cell single-select" data-group="time-distance">2.5</td>
                    <td data-score="3" class="selectable-cell single-select" data-group="time-distance">3</td>
                    <td data-score="3.5" class="selectable-cell single-select" data-group="time-distance">3.5</td>
                    <td data-score="4" class="selectable-cell single-select" data-group="time-distance">4</td>
                    <td data-score="5" class="selectable-cell single-select" data-group="time-distance">5</td>
                    <td data-score="6" class="selectable-cell single-select" data-group="time-distance">6</td>
                    <td data-score="7" class="selectable-cell single-select" data-group="time-distance">7</td>
                    <td data-score="8" class="selectable-cell single-select" data-group="time-distance">8</td>
                    <td data-score="9" class="selectable-cell single-select" data-group="time-distance">9</td>
                    <td data-score="10" class="selectable-cell single-select" data-group="time-distance">10</td>
                </tr>
            </tbody>
        </table>
        <label style="margin-top:10px;">ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ (Ù…ØªØ±): <input id="distanceCustom" type="number" min="1"></label>
    </div>

    <div id="durationWrap" style="display:none; margin-top:10px;">
        <h4>Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø¯Øª Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</h4>
         <table class="horizontal-score-table">
            <thead>
                <tr>
                    <th class="label-cell">Ù…Ø¯Øª Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡)</th>
                    <th>ØªØ§ 1</th><th>ØªØ§ 5</th><th>ØªØ§ 10</th><th>ØªØ§ 20</th><th>ØªØ§ 30</th><th>ØªØ§ 45</th><th>ØªØ§ 60</th><th>ØªØ§ 100</th><th>ØªØ§ 150</th><th>ØªØ§ 210</th><th>ØªØ§ 270</th><th>ØªØ§ 360</th><th>ØªØ§ 480</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="label-cell">Ø§Ù…ØªÛŒØ§Ø²</td>
                    <td data-score="1" class="selectable-cell single-select" data-group="time-duration">1</td>
                    <td data-score="1.5" class="selectable-cell single-select" data-group="time-duration">1.5</td>
                    <td data-score="2" class="selectable-cell single-select" data-group="time-duration">2</td>
                    <td data-score="2.5" class="selectable-cell single-select" data-group="time-duration">2.5</td>
                    <td data-score="3" class="selectable-cell single-select" data-group="time-duration">3</td>
                    <td data-score="3.5" class="selectable-cell single-select" data-group="time-duration">3.5</td>
                    <td data-score="4" class="selectable-cell single-select" data-group="time-duration">4</td>
                    <td data-score="5" class="selectable-cell single-select" data-group="time-duration">5</td>
                    <td data-score="6" class="selectable-cell single-select" data-group="time-duration">6</td>
                    <td data-score="7" class="selectable-cell single-select" data-group="time-duration">7</td>
                    <td data-score="8" class="selectable-cell single-select" data-group="time-duration">8</td>
                    <td data-score="9" class="selectable-cell single-select" data-group="time-duration">9</td>
                    <td data-score="10" class="selectable-cell single-select" data-group="time-duration">10</td>
                </tr>
            </tbody>
        </table>
      <label style="margin-top:10px;">ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ (Ø¯Ù‚ÛŒÙ‚Ù‡): <input id="durationCustom" type="number" min="1"></label>
    </div>

    <div class="score-box" id="timeScore">Ø§Ù…ØªÛŒØ§Ø² Ø²Ù…Ø§Ù† (Ø¶Ø±ÛŒØ¨): â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ø¯ÙˆÙ…: Ø§Ù…ØªÛŒØ§Ø² ÙˆØ³ÛŒÙ„Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„ Ùˆ ÙˆØ²Ù† Ø¨Ø§Ø±</h3>
    <table class="device-table">
      <thead>
        <tr>
          <th colspan="3">ÙØ±ØºÙˆÙ† Ùˆ Ú†Ø±Ø® Ø¯Ø³ØªÛŒ ØªÚ© Ù…Ø­ÙˆØ±</th>
          <th colspan="2">ÙÙ‚Ø· Ú†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯Ø§Ù†</th>
          <th colspan="2">Ø¨Ø§ Ú†Ø±Ø®â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ú¯Ø±Ø¯Ø§Ù† ÛŒØ§ Ú†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯Ø§Ù† Ù‚ÙÙ„ Ø´ÙˆÙ†Ø¯Ù‡</th>
          <th>Ø¨Ø§ ÙØ±Ù…Ø§Ù† Ø¯Ø³ØªÛŒ</th>
          <th>Ú©Ø§Ù†ÙˆØ§ÛŒØ± Ù‡ÙˆØ§ÛŒÛŒ</th>
          <th>Ø¬Ø±Ø«Ù‚ÛŒÙ„ Ø³Ù‚ÙÛŒ</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="1">
              <img src="images/device_1.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="2">
              <img src="images/device_2.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="3">
              <img src="images/device_3.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="4">
              <img src="images/device_4.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="5">
              <img src="images/device_5.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="6">
              <img src="images/device_6.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="7">
              <img src="images/device_7.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="8">
              <img src="images/device_8.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="9">
              <img src="images/device_9.png" alt="" class="device-image">
              <span></span>
          </td>
          <td class="device-cell selectable-cell single-select" data-group="device" data-value="10">
              <img src="images/device_10.png" alt="" class="device-image">
              <span></span>
          </td>
        </tr>
      </tbody>
    </table>
   
    <div style="margin-top:20px;">
       <label>ÙˆØ²Ù† Ø¨Ø§Ø± (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…):</label>
      <select id="weightRange">
        <option value="null" data-weight-score="null">â€” Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ â€”</option>
        <option value="0">ØªØ§ 50</option>
        <option value="50">Ø¨ÛŒØ´ Ø§Ø² 50 ØªØ§ 100</option>
        <option value="100">Ø¨ÛŒØ´ Ø§Ø² 100 ØªØ§ 200</option>
        <option value="200">Ø¨ÛŒØ´ Ø§Ø² 200 ØªØ§ 300</option>
        <option value="300">Ø¨ÛŒØ´ Ø§Ø² 300 ØªØ§ 400</option>
        <option value="400">Ø¨ÛŒØ´ Ø§Ø² 400 ØªØ§ 600</option>
        <option value="600">Ø¨ÛŒØ´ Ø§Ø² 600 ØªØ§ 800</option>
        <option value="800">Ø¨ÛŒØ´ Ø§Ø² 800 ØªØ§ 1000</option>
        <option value="1000">Ø¨ÛŒØ´ Ø§Ø² 1000 ØªØ§ 1300</option>
        <option value="1300">Ø¨ÛŒØ´ Ø§Ø² 1300</option>
      </select>
      <label style="margin-top:10px;">ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø³ØªÛŒ ÙˆØ²Ù† (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…): <input id="weightCustom" type="number" min="1" placeholder="Ù…Ù‚Ø¯Ø§Ø± Ø¯Ø³ØªÛŒ Ø¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ù†Ùˆ Ø§Ø±Ø¬Ø­ÛŒØª Ø¯Ø§Ø±Ø¯"></label>
    </div>

    <div class="score-box" id="finalScore">Ø§Ù…ØªÛŒØ§Ø² ÙˆØ³ÛŒÙ„Ù‡ Ã— ÙˆØ²Ù†: â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ø³ÙˆÙ…: ØªØ¹ÛŒÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ø´Ø±Ø§ÛŒØ· Ù…Ø³ÛŒØ± Ø­Ø±Ú©Øª Ùˆ Ø´ÛŒØ¨/Ù¾Ù„Ù‡</h3>
    <table class="path-score-table" style="margin-bottom:var(--spacing);">
      <thead>
        <tr>
          <th>Ø´Ø±Ø§ÛŒØ· Ù…Ø³ÛŒØ±</th>
          <th class="path-col-header" data-group="path-col1">
            <img src="images/path_col_1.png" alt="Ù†ÙˆØ¹ Ù…Ø³ÛŒØ± Û± - Ø§Ù…ØªÛŒØ§Ø²" title="Ø³ØªÙˆÙ† Û±" style="max-height: 100%;">
          </th>
          <th class="path-col-header" data-group="path-col2">
            <img src="images/path_col_2.png" alt="Ù†ÙˆØ¹ Ù…Ø³ÛŒØ± Û² - Ø§Ù…ØªÛŒØ§Ø²" title="Ø³ØªÙˆÙ† Û²" style="max-height: 100%;">
          </th>
          <th class="path-col-header" data-group="path-col3">
            Ø³Ø§ÛŒØ± ØªØ¬Ù‡ÛŒØ²Ø§Øª Ú†Ø±Ø® Ø¯Ø§Ø±
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Ù…Ø³ÛŒØ± ØµØ§ÙØŒ Ù‡Ù…ÙˆØ§Ø±ØŒ Ù…Ø­Ú©Ù…ØŒ Ø®Ø´Ú© Ùˆ Ø¨Ø¯ÙˆÙ† Ø´ÛŒØ¨</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="1">0</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="2">0</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="3">0</td>
        </tr>
        <tr>
          <td>Ù…Ø³ÛŒØ± Ø¹Ù…Ø¯ØªØ§Ù‹ ØµØ§Ù Ùˆ Ù‡Ù…ÙˆØ§Ø± Ø¨Ø§ Ù†Ù‚Ø§Ø· Ø¢Ø³ÛŒØ¨â€ŒØ¯ÛŒØ¯Ù‡ ÛŒØ§ Ø§ÛŒØ±Ø§Ø¯Ø§Øª Ø¬Ø²Ø¦ÛŒ Ùˆ Ø¨Ø¯ÙˆÙ† Ø´ÛŒØ¨</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="1">0</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="2">0</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="1" data-col="3">1</td>
        </tr>
        <tr>
          <td>ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø² Ø³Ù†Ú¯ÙØ±Ø´ØŒ Ø¨ØªÙ†ØŒ Ø¢Ø³ÙØ§Ù„ØªØŒ Ø´ÛŒØ¨ Ú©Ù… Ùˆ Ø¨Ø±Ø¢Ù…Ø¯Ú¯ÛŒâ€ŒÙ‡Ø§</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="0" data-col="1">0</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="1" data-col="2">1</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="2" data-col="3">2</td>
        </tr>
        <tr>
          <td>ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ø² Ø³Ù†Ú¯â€ŒÙØ±Ø´ Ù†Ø§Ù…Ø±ØªØ¨ØŒ Ù…Ø§Ø³Ù‡ Ø³ÙØªØŒ Ø´ÛŒØ¨ Ú©Ù…ØŒ Ù„Ø¨Ù‡â€ŒÙ‡Ø§/Ù…ÙˆØ§Ù†Ø¹ Ú©ÙˆÚ†Ú©</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="1" data-col="1">1</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="2" data-col="2">2</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="3" data-col="3">3</td>
        </tr>
        <tr>
          <td>Ù…Ø³ÛŒØ± Ø®Ø§Ú©ÛŒ ÛŒØ§ Ø³Ù†Ú¯ÙØ±Ø´ Ù†Ø§Ù‡Ù…ÙˆØ§Ø±ØŒ Ø¨Ø§ Ú†Ø§Ù„Ù‡â€ŒÚ†ÙˆÙ„Ù‡ØŒ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø²ÛŒØ§Ø¯ØŒ Ø´ÛŒØ¨ Ú©Ù…ØŒ Ø¨Ø±Ø¢Ù…Ø¯Ú¯ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù…ÙˆØ§Ù†Ø¹ Ø¨Ø±Ø¬Ø³ØªÙ‡</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="3" data-col="1">3</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="5" data-col="2">5</td>
          <td class="selectable-cell single-select path-col" data-group="path" data-score="6" data-col="3">6</td>
        </tr>
      </tbody>
    </table>
    <table class="one-column-score-table">
      <thead>
        <tr><th>Ø´Ø±Ø§ÛŒØ· Ø´ÛŒØ¨/Ù¾Ù„Ù‡</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr>
      </thead>
      <tbody>
        <tr><td class="selectable-cell single-select selected" data-group="slope" data-score="0">Ø¨Ø¯ÙˆÙ† Ø´ÛŒØ¨/Ù¾Ù„Ù‡</td><td style="text-align:center;">0</td></tr>
        <tr><td class="selectable-cell single-select" data-group="slope" data-score="5">Ø´ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ù…Ù„Ø§ÛŒÙ…: Ø§Ø² Û² ØªØ§ Û´ Ø¯Ø±Ø¬Ù‡ (Û´ ØªØ§ Û¸ Ø¯Ø±ØµØ¯)</td><td style="text-align:center;">5</td></tr>
        <tr><td class="selectable-cell single-select" data-group="slope" data-score="10">Ø´ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ù…ØªÙˆØ³Ø·: Ø§Ø² Ûµ ØªØ§ Û±Û° Ø¯Ø±Ø¬Ù‡ (Û¹ ØªØ§ Û±Û¸ Ø¯Ø±ØµØ¯)</td><td style="text-align:center;">10</td></tr>
        <tr><td class="selectable-cell single-select" data-group="slope" data-score="25">Ù¾Ù„Ù‡â€ŒÙ‡Ø§: Ø´ÛŒØ¨â€ŒÙ‡Ø§ÛŒ ØªÙ†Ø¯ØªØ± Ø§Ø² Û±Û° Ø¯Ø±Ø¬Ù‡ (Ø¨ÛŒØ´ Ø§Ø² Û±Û¸ Ø¯Ø±ØµØ¯)</td><td style="text-align:center;">25</td></tr>
      </tbody>
    </table>
    <div class="score-box" id="pathSlopeScore">Ø§Ù…ØªÛŒØ§Ø² Ù…Ø³ÛŒØ± + Ø´ÛŒØ¨/Ù¾Ù„Ù‡: â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ú†Ù‡Ø§Ø±Ù…: Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ Ú©Ø§Ø±</h3>
    <table class="one-column-score-table">
      <thead><tr><th>Ø´Ø±Ø·</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr></thead>
      <tbody>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="3">Ø´Ø±ÙˆØ¹ Ø­Ø±Ú©Øª Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªÙ„Ø§Ø´ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±Ø¯ (Ú¯ÛŒØ± Ú©Ø±Ø¯Ù† ÛŒØ§ ÙØ±Ùˆ Ø±ÙØªÙ† ÙˆØ³ÛŒÙ„Ù‡)</td><td style="text-align:center;">3</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="1">ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø±: Ø¨Ø¯ÙˆÙ† ØªØ±Ù…Ø²Ú¯ÛŒØ±ÛŒ</td><td style="text-align:center;">1</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="3">ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø±: Ø¨Ø§ ØªØ±Ù…Ø²Ú¯ÛŒØ±ÛŒ</td><td style="text-align:center;">3</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="3">ØªØºÛŒÛŒØ± Ù…Ø³ÛŒØ± ÛŒØ§ Ù¾ÛŒÚ†â€ŒÙ‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯ØŒ Ù…Ø§Ù†ÙˆØ±Ù‡Ø§ÛŒ Ù…Ú©Ø±Ø±</td><td style="text-align:center;">3</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="1">Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ùˆ ØªÙˆÙ‚Ù Ø¨Ø§Ø±ØŒ Ø±Ø¹Ø§ÛŒØª Ø¯Ù‚ÛŒÙ‚ Ù…Ø³ÛŒØ± Ø­Ø±Ú©Øª</td><td style="text-align:center;">1</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="unfavorable" data-score="2">Ø­Ø±Ú©Øª Ø¨Ø§ Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ØªØ± Ø§Ø² Ù…Ø¹Ù…ÙˆÙ„ (Û±.Û° ØªØ§ Û±.Û³ Ù…ØªØ± Ø¨Ø± Ø«Ø§Ù†ÛŒÙ‡)</td><td style="text-align:center;">2</td></tr>
        <tr><td class="selectable-cell multi-select none-option selected" data-group="unfavorable" data-score="0">Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù…: Ù‡ÛŒÚ† ÛŒÚ© Ø§Ø² Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</td><td style="text-align:center;">0</td></tr>
      </tbody>
    </table>
    <div class="score-box" id="unfavorableScore">Ø§Ù…ØªÛŒØ§Ø² Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ø·Ù„ÙˆØ¨: â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ù¾Ù†Ø¬Ù…: ØªØ¹ÛŒÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ ÙˆØ³ÛŒÙ„Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„</h3>
    <table class="one-column-score-table">
      <thead><tr><th>ÙˆÛŒÚ˜Ú¯ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr></thead>
      <tbody>
        <tr><td class="selectable-cell multi-select" data-group="device-bad" data-score="2">Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø³ØªÚ¯ÛŒØ±Ù‡ ÛŒØ§ Ù†Ù‚Ø§Ø· Ù…Ù†Ø§Ø³Ø¨ Ø¨Ø±Ø§ÛŒ Ø§Ø¹Ù…Ø§Ù„ Ù†ÛŒØ±Ùˆ</td><td style="text-align:center;">2</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="device-bad" data-score="3">Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØ±Ù…Ø² Ø¯Ø± Ø´ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ Ø§Ø² Û² Ø¯Ø±Ø¬Ù‡ (Ø¨ÛŒØ´ Ø§Ø² Û³ Ø¯Ø±ØµØ¯)</td><td style="text-align:center;">3</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="device-bad" data-score="2">Ú†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ ÛŒØ§ ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ (Ù…Ø«Ù„Ø§Ù‹ Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø³Ø·ÙˆØ­ Ù†Ø±Ù… ÛŒØ§ Ù†Ø§Ù‡Ù…ÙˆØ§Ø±)</td><td style="text-align:center;">2</td></tr>
        <tr><td class="selectable-cell multi-select" data-group="device-bad" data-score="2">Ú†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ÛŒÙˆØ¨ (ÙØ±Ø³ÙˆØ¯Ù‡ØŒ Ø³Ø§ÛŒÛŒØ¯Ù‡ØŒ Ø³ÙØªØŒ Ú©Ù… Ø¨Ø§Ø¯)</td><td style="text-align:center;">2</td></tr>
        <tr><td class="selectable-cell multi-select none-option selected" data-group="device-bad" data-score="0">Ù‡ÛŒÚ†â€ŒÚ©Ø¯Ø§Ù…: Ù‡ÛŒÚ† ÛŒÚ© Ø§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯</td><td style="text-align:center;">0</td></tr>
      </tbody>
    </table>
    <div class="score-box" id="deviceBadScore">Ø§Ù…ØªÛŒØ§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ ÙˆØ³ÛŒÙ„Ù‡: â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ø´Ø´Ù…: ØªØ¹ÛŒÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ù¾ÙˆØ³Ú†Ø± Ùˆ Ø­Ø±Ú©Ø§Øª Ø¨Ø¯Ù† ÙØ±Ø¯ Ø­Ù…Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø§Ø±</h3>
    <table class="three-column-score-table-posture">
      <thead>
        <tr><th style="width:120px;">ØªØµÙˆÛŒØ± Ù¾ÙˆØ³Ú†Ø±</th><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr>
      </thead>
      <tbody>
        <tr>
          <td class="posture-image-cell selectable-cell single-select selected" data-group="posture" data-score="3">
            <img src="images/posture_1.png" alt="Ù¾ÙˆØ³Ú†Ø± Û±" class="posture-image">
          </td>
          <td class="selectable-cell single-select selected" data-group="posture" data-score="3">Ø¨Ø§Ù„Ø§ØªÙ†Ù‡ ØµØ§Ù ÛŒØ§ Ú©Ù…ÛŒ Ø¨Ù‡ Ø¬Ù„Ùˆ Ù…ØªÙ…Ø§ÛŒÙ„ØŒ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒÚ†Ø´<br>Ø§Ø±ØªÙØ§Ø¹ Ø§Ø¹Ù…Ø§Ù„ Ù†ÛŒØ±Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ù„Ø®ÙˆØ§Ù‡ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³Øª.<br>Ù‡ÛŒÚ† Ú¯ÙˆÙ†Ù‡ Ù…Ø§Ù†Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù¾Ø§Ù‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</td>
          <td style="text-align:center;">3</td>
        </tr>
        <tr>
          <td class="posture-image-cell selectable-cell single-select" data-group="posture" data-score="5">
            <img src="images/posture_2.png" alt="Ù¾ÙˆØ³Ú†Ø± Û²" class="posture-image">
          </td>
          <td class="selectable-cell single-select" data-group="posture" data-score="5">Ø¨Ø§Ù„Ø§ØªÙ†Ù‡ Ø¨Ù‡ Ø³Ù…Øª Ø¬Ù‡Øª Ø­Ø±Ú©Øª Ù…ØªÙ…Ø§ÛŒÙ„ Ø§Ø³Øª ÛŒØ§ Ù‡Ù†Ú¯Ø§Ù… Ú©Ø´ÛŒØ¯Ù† Ø¨Ø§Ø± Ø§Ø² ÛŒÚ© Ø·Ø±ÙØŒ Ù¾ÛŒÚ†Ø´ Ú©Ù…ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.<br>Ø§Ø±ØªÙØ§Ø¹ Ø§Ø¹Ù…Ø§Ù„ Ù†ÛŒØ±Ùˆ Ø«Ø§Ø¨Øª Ùˆ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ 0.9 ØªØ§ 1.2 Ù…ØªØ± Ø§Ø³Øª.<br>ØªØ¹Ø¯Ø§Ø¯ Ù…ÙˆØ§Ù†Ø¹ Ú©Ù… Ø§Ø³Øª ÛŒØ§ Ù‡ÛŒÚ† Ù…Ø§Ù†Ø¹ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù¾Ø§Ù‡Ø§ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.<br>Ø¹Ù…Ø¯ØªØ§Ù‹ Ø¹Ù…Ù„ Ú©Ø´ÛŒØ¯Ù† Ø¨Ø§Ø± Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯.</td>
          <td style="text-align:center;">5</td>
        </tr>
        <tr>
          <td class="posture-image-cell selectable-cell single-select" data-group="posture" data-score="8">
            <img src="images/posture_3.png" alt="Ù¾ÙˆØ³Ú†Ø± Û³" class="posture-image">
          </td>
          <td class="selectable-cell single-select" data-group="posture" data-score="8">Ù¾ÙˆØ³Ú†Ø±Ù‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ Ø¨Ø¯Ù† Ù†Ø§Ø´ÛŒ Ø§Ø²:<br>- Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø§Ø¹Ù…Ø§Ù„ Ù†ÛŒØ±Ùˆ Ú©Ù…ØªØ± Ø§Ø² 0.9 Ù…ØªØ± ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø§Ø² 1.2 Ù…ØªØ±<br>- Ø§Ø¹Ù…Ø§Ù„ Ù†ÛŒØ±Ùˆ Ø§Ø² Ù¾Ù‡Ù„Ùˆ Ø¯Ø± ÛŒÚ© Ø·Ø±Ù<br>- Ø¯ÛŒØ¯ Ø¨Ù‡ Ø·ÙˆØ± Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ÛŒ Ù…Ø­Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª.<br>- ÙˆØ¬ÙˆØ¯ Ù…ÙˆØ§Ù†Ø¹ Ø²ÛŒØ§Ø¯ Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Øª Ù¾Ø§Ù‡Ø§<br>- Ù¾ÛŒÚ†Ø´ Ù…Ú©Ø±Ø±/Ù…Ø¯Ø§ÙˆÙ… Ùˆ/ÛŒØ§ Ø®Ù…Ø´ Ø¬Ø§Ù†Ø¨ÛŒ Ù‚Ø§Ø¨Ù„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ø¨Ø§Ù„Ø§ØªÙ†Ù‡</td>
          <td style="text-align:center;">8</td>
        </tr>
      </tbody>
    </table>
    <div class="score-box" id="postureScore">Ø§Ù…ØªÛŒØ§Ø² Ù¾ÙˆØ³Ú†Ø±: â€”</div>
  </div>

  <div class="card">
    <h3>Ú¯Ø§Ù… Ù‡ÙØªÙ…: ØªØ¹ÛŒÛŒÙ† Ø§Ù…ØªÛŒØ§Ø² Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ ØªÙ†ÙˆØ¹ Ùˆ ØªÚ©Ø±Ø§Ø± ÙˆØ¸Ø§ÛŒÙ</h3>
    <table class="one-column-score-table">
      <thead><tr><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø§Ù…ØªÛŒØ§Ø²</th></tr></thead>
      <tbody>
        <tr><td class="selectable-cell single-select selected" data-group="variety" data-score="0">Ù…Ø·Ù„ÙˆØ¨: ØªÙ†ÙˆØ¹ Ø²ÛŒØ§Ø¯ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ Ø¯Ø± Ø·ÙˆÙ„ Ø´ÛŒÙØª Ú©Ø§Ø±ÛŒ Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ Ø§Ù†Ø¬Ø§Ù… ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ù…Ø®ØªÙ„Ù...</td><td style="text-align:center;">0</td></tr>
        <tr><td class="selectable-cell single-select" data-group="variety" data-score="2">Ù…Ø­Ø¯ÙˆØ¯: ØªÙ†ÙˆØ¹ Ú©Ù… Ø¯Ø± ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ. Ù‡Ù…Ú†Ù†ÛŒÙ†ØŒ Ú¯Ø§Ù‡ÛŒ Ù…Ù…Ú©Ù† Ø§Ø³Øª ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ† Ú©ÙˆØªØ§Ù‡â€ŒÙ…Ø¯Øª Ø¨Ø§ Ù…Ø§Ù‡ÛŒØª ØªÚ©Ø±Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.</td><td style="text-align:center;">2</td></tr>
        <tr><td class="selectable-cell single-select" data-group="variety" data-score="4">Ù†Ø§Ù…Ø·Ù„ÙˆØ¨: ØªÙ†ÙˆØ¹ Ú©Ù… Ø¯Ø± ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙÛŒØ²ÛŒÚ©ÛŒ. Ù‡Ù…Ú†Ù†ÛŒÙ†ØŒ Ø¯Ø± Ø·ÙˆÙ„ Ø´ÛŒÙØªØŒ ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ†ØŒ ÙØ´Ø±Ø¯Ù‡ Ùˆ ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ Ù…Ø§Ù‡ÛŒØª ÛŒÚ©Ø³Ø§Ù† Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ú©Ù‡ Ú¯Ø§Ù‡ÛŒ Ø¨Ø§ Ø§ÙØ²Ø§ÛŒØ´ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ Ø´Ø¯Øª ÛŒØ§ Ù…Ø¯Øª Ú©Ø§Ø± Ù‡Ù…Ø±Ø§Ù‡ Ø§Ø³Øª.</td><td style="text-align:center;">4</td></tr>
      </tbody>
    </table>
    <div class="score-box" id="varietyScore">Ø§Ù…ØªÛŒØ§Ø² ØªÙ†ÙˆØ¹ ÙˆØ¸Ø§ÛŒÙ: â€”</div>
  </div>

  <div class="card" id="step8">
    <h3>Ú¯Ø§Ù… Ù‡Ø´ØªÙ…: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ø³Ø·Ø­ Ø±ÛŒØ³Ú© Ùˆ Ø§Ù‚Ø¯Ø§Ù… Ø§ØµÙ„Ø§Ø­ÛŒ</h3>
    <table>
      <tbody>
        <tr><td style="font-weight:bold;">ÙˆØ²Ù† Ø¨Ø§Ø± / ÙˆØ³ÛŒÙ„Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„</td><td id="scoreDeviceWeight">â€”</td></tr>
        <tr><td style="font-weight:bold;">Ø´Ø±Ø§ÛŒØ· Ù…Ø³ÛŒØ± Ø­Ø±Ú©Øª + Ø´ÛŒØ¨/Ù¾Ù„Ù‡</td><td id="scorePathSlope">â€”</td></tr>
        <tr><td style="font-weight:bold;">Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ Ú©Ø§Ø± (Î£)</td><td id="scoreUnfavorable">â€”</td></tr>
        <tr><td style="font-weight:bold;">ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ ÙˆØ³ÛŒÙ„Ù‡ Ø­Ù…Ù„ Ùˆ Ù†Ù‚Ù„ (Î£)</td><td id="scoreDeviceBad">â€”</td></tr>
        <tr><td style="font-weight:bold;">Ù¾ÙˆØ³Ú†Ø± Ø¨Ø¯Ù†</td><td id="scorePosture">â€”</td></tr>
        <tr><td style="font-weight:bold;">ØªÙ†ÙˆØ¹ Ùˆ ØªÚ©Ø±Ø§Ø± ÙˆØ¸Ø§ÛŒÙ</td><td id="scoreVariety">â€”</td></tr>
        <tr><td style="font-weight:bold; background:#f0f0f0;">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø² Ø´Ø§Ø®Øµ (Ø¬Ù…Ø¹ Û¶ Ù…ÙˆØ±Ø¯ Ø¨Ø§Ù„Ø§)</td><td style="font-weight:bold; background:#f0f0f0;" id="scoreIndex">â€”</td></tr>
        <tr><td style="font-weight:bold;">Ø§Ù…ØªÛŒØ§Ø² Ø²Ù…Ø§Ù† (Ø¶Ø±ÛŒØ¨)</td><td id="scoreTimeFinal">â€”</td></tr>
        <tr><td style="font-weight:bold; background:#e9f5ff; color:var(--primary-color);">Ø§Ù…ØªÛŒØ§Ø² Ù†Ù‡Ø§ÛŒÛŒ ÙØ¹Ø§Ù„ÛŒØª ÙØ±Ø¹ÛŒ</td><td style="font-weight:bold; background:#e9f5ff; color:var(--primary-color);" id="finalActivityScore">â€”</td></tr>
      </tbody>
    </table>

    <div class="inline" style="margin-top:20px; display:flex; gap: 20px;">
      <label><input type="checkbox" id="twoPerson"> Ú©Ø´ÛŒØ¯Ù† ÛŒØ§ Ù‡Ù„ Ø¯Ø§Ø¯Ù† Ø¯Ùˆ Ù†ÙØ±Ù‡ (Ã—0.7)</label>
      <label><input type="checkbox" id="female"> Ø§Ú¯Ø± Ø®Ø§Ù†Ù… Ø¨Ø§Ø´Ø¯ (Ã—1.3)</label>
    </div>
  </div>

  <div class="card" id="step9">
    <h3>Ú¯Ø§Ù… Ù†Ù‡Ø§ÛŒÛŒ: Ø¬Ø¯ÙˆÙ„ Ø³Ø·Ø­ Ø±ÛŒØ³Ú© Ùˆ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§ØµÙ„Ø§Ø­ÛŒ</h3>
    <table id="riskTable">
      <thead>
        <tr>
          <th>Ø±ÛŒØ³Ú©</th><th>Ø³Ø·Ø­ Ø±ÛŒØ³Ú©</th><th>Ø´Ø¯Øª Ø¨Ø§Ø±</th><th>Ø§Ù„Ù) Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ<br>Ø¨) Ù¾ÛŒØ§Ù…Ø¯Ù‡Ø§ÛŒ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ</th><th>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
        </tr>
      </thead>
      <tbody>
        <tr data-min="0" data-max="19.99" data-risk="1">
          <td>1</td><td>Ú©Ù…ØªØ± Ø§Ø² 20</td><td>Ù¾Ø§ÛŒÛŒÙ†</td><td>Ø§Ù„Ù) Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ Ú©Ù… Ø§Ø³Øª.<br>Ø¨) Ù‡ÛŒÚ† Ø®Ø·Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯.</td><td>Ù†ÛŒØ§Ø²ÛŒ Ù†ÛŒØ³Øª.</td>
        </tr>
        <tr data-min="20" data-max="49.99" data-risk="2">
          <td>2</td><td>Ø¨ÛŒÙ† 20 ØªØ§ Ú©Ù…ØªØ± Ø§Ø² 50</td><td>Ú©Ù…ÛŒ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡</td><td>Ø§Ù„Ù) Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ú©Ù…â€ŒØªØ­Ù…Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.<br>Ø¨) Ø®Ø³ØªÚ¯ÛŒ Ùˆ Ø§Ø®ØªÙ„Ø§Ù„ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¨Ø§ Ø´Ø¯Øª Ú©Ù… Ú©Ù‡ Ø¯Ø± Ø²Ù…Ø§Ù† ÙØ±Ø§ØºØª Ø¬Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØ´ÙˆØ¯.</td><td>Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù¾ÛŒØ´Ú¯ÛŒØ±Ø§Ù†Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ù…ÙÛŒØ¯ Ø¨Ø§Ø´Ø¯.</td>
        </tr>
        <tr data-min="50" data-max="99.99" data-risk="3">
          <td>3</td><td>Ø¨ÛŒÙ† 50 ØªØ§ Ú©Ù…ØªØ± Ø§Ø² 100</td><td>Ø¨Ù‡â€ŒØ·ÙˆØ± Ú†Ø´Ù…Ú¯ÛŒØ±ÛŒ Ø§ÙØ²Ø§ÛŒØ´ ÛŒØ§ÙØªÙ‡</td><td>Ø§Ù„Ù) Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ Ø­ØªÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÙØ±Ø§Ø¯ Ø¨Ø§ ØªØ­Ù…Ù„ Ù…ØªÙˆØ³Ø· Ù†ÛŒØ² Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø±Ø® Ø¯Ù‡Ø¯.<br>Ø¨) Ø§Ø®ØªÙ„Ø§Ù„Ø§Øª (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ù‡Ù…Ø±Ø§Ù‡ Ø¨Ø§ Ø¯Ø±Ø¯) Ú©Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø´Ø§Ù…Ù„ Ø§Ø®ØªÙ„Ø§Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø§Ù†Ø¯Ø§Ù…â€ŒÙ‡Ø§ Ø¨Ø§Ø´Ø¯ØŒ Ø¯Ø± Ø§Ú©Ø«Ø± Ù…ÙˆØ§Ø±Ø¯ Ù…ÙˆÙ‚ØªÛŒ Ù‡Ø³ØªÙ†Ø¯.</td><td>Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ Ùˆ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù¾ÛŒØ´Ú¯ÛŒØ±Ø§Ù†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø±Ø³ÛŒ Ø´ÙˆÙ†Ø¯.</td>
        </tr>
        <tr data-min="100" data-max="999999" data-risk="4">
          <td>4</td><td>Ø¨Ø±Ø§Ø¨Ø± ÛŒØ§ Ø¨ÛŒØ´ØªØ± Ø§Ø² 100</td><td>Ø¨Ø§Ù„Ø§</td><td>Ø§Ù„Ù) Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø¶Ø§ÙÙ‡ Ø¨Ø§Ø± ÙÛŒØ²ÛŒÚ©ÛŒ Ø¨Ø§Ù„Ø§Ø³Øª.<br>Ø¨) Ø¢Ø³ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªØ§Ø±ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ Ø¨Ø§ Ø¹ÙˆØ§Ù‚Ø¨ Ø¨ÛŒÙ…Ø§Ø±ÛŒâ€ŒØ²Ø§ Ùˆ Ø§Ø®ØªÙ„Ø§Ù„ Ø¹Ù…Ù„Ú©Ø±Ø¯ÛŒ Ø´Ø¯ÛŒØ¯.</td><td>Ø¨Ø§Ø²Ø·Ø±Ø§Ø­ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª Ùˆ Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ù¾ÛŒØ´Ú¯ÛŒØ±Ø§Ù†Ù‡ Ø¨Ø§ÛŒØ¯ Ù…Ø¯Ù†Ø¸Ø± Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ù†Ø¯.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="print-section">
    <button class="print-btn" onclick="printFinalResults()">
      ğŸ–¨ï¸ Ú†Ø§Ù¾ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ
    </button>
  </div>

  <script>
    // ---------------------- 1. Shamsi Date Logic ----------------------
    const SHAMSI_MONTHS = ["ÙØ±ÙˆØ±Ø¯ÛŒÙ†", "Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª", "Ø®Ø±Ø¯Ø§Ø¯", "ØªÛŒØ±", "Ù…Ø±Ø¯Ø§Ø¯", "Ø´Ù‡Ø±ÛŒÙˆØ±", "Ù…Ù‡Ø±", "Ø¢Ø¨Ø§Ù†", "Ø¢Ø°Ø±", "Ø¯ÛŒ", "Ø¨Ù‡Ù…Ù†", "Ø§Ø³ÙÙ†Ø¯"];
    const CURRENT_SHAMSI_YEAR = 1404; 

    function populateShamsiDate() {
      const yearSelect = document.getElementById('year');
      const monthSelect = document.getElementById('month');
      const daySelect = document.getElementById('day');
      
      for (let y = CURRENT_SHAMSI_YEAR - 3; y <= CURRENT_SHAMSI_YEAR + 3; y++) {
        const option = document.createElement('option');
        option.value = y;
        option.textContent = y;
        yearSelect.appendChild(option);
      }
      
      SHAMSI_MONTHS.forEach((name, index) => {
        const option = document.createElement('option');
        option.value = index + 1; 
        option.textContent = name;
        monthSelect.appendChild(option);
      });
      
      for (let d = 1; d <= 31; d++) {
        const option = document.createElement('option');
        option.value = d;
        option.textContent = d;
        daySelect.appendChild(option);
      }
    }
    
    // ---------------------- 2. Device/Weight Matrix & Interpolation ----------------------
    const SCORE_MATRIX = [
        [3, 2, 2.5, 2.5, 3, 1, 1, 1, 1, 2],       // ØªØ§ 50
        [5, 3, 4, 3, 4, 1, 1, 1, 1, 2.5],         // Ø¨ÛŒØ´ Ø§Ø² 50 ØªØ§ 100
        [10, 6, 7, 4, 6, 2, 1.5, 1.5, 1.5, 3.5],  // Ø¨ÛŒØ´ Ø§Ø² 100 ØªØ§ 200
        [50, 12, 50, 5, 8, 3, 2, 2, 2, 4.5],      // Ø¨ÛŒØ´ Ø§Ø² 200 ØªØ§ 300
        [100, 50, 100, 7, 12, 4, 3, 2.5, 2.5, 6], // Ø¨ÛŒØ´ Ø§Ø² 300 ØªØ§ 400
        [100, 100, 100, 12, 50, 6, 5, 4, 4, 10],  // Ø¨ÛŒØ´ Ø§Ø² 400 ØªØ§ 600
        [100, 100, 100, 50, 100, 10, 8, 7, 7, 15], // Ø¨ÛŒØ´ Ø§Ø² 600 ØªØ§ 800
        [100, 100, 100, 100, 100, 15, 12, 10, 10, 50], // Ø¨ÛŒØ´ Ø§Ø² 800 ØªØ§ 1000
        [100, 100, 100, 100, 100, 50, 50, 50, 20, 100], // Ø¨ÛŒØ´ Ø§Ø² 1000 ØªØ§ 1300
        [100, 100, 100, 100, 100, 100, 100, 100, 50, 100] // Ø¨ÛŒØ´ Ø§Ø² 1300
    ];

    const WEIGHT_THRESHOLDS = [50, 100, 200, 300, 400, 600, 800, 1000, 1300];

    function interpolateScore(weight, deviceIndex) {
        if (weight <= 0) return 0;
        
        // Ø§Ú¯Ø± ÙˆØ²Ù† Ú©Ù…ØªØ± ÛŒØ§ Ù…Ø³Ø§ÙˆÛŒ Ø§ÙˆÙ„ÛŒÙ† Ø¢Ø³ØªØ§Ù†Ù‡ Ø¨Ø§Ø´Ø¯ (50)
        if (weight <= 50) {
            return SCORE_MATRIX[0][deviceIndex];
        }
        
        // Ø¨Ø§Ø²Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆØ²Ù†ÛŒ Ùˆ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ù…ØªÙ†Ø§Ø¸Ø± Ø¯Ø± Ù…Ø§ØªØ±ÛŒØ³
        const ranges = [
            { min: 0, max: 50, score: SCORE_MATRIX[0][deviceIndex] },
            { min: 50, max: 100, lowerScore: SCORE_MATRIX[0][deviceIndex], upperScore: SCORE_MATRIX[1][deviceIndex] },
            { min: 100, max: 200, lowerScore: SCORE_MATRIX[1][deviceIndex], upperScore: SCORE_MATRIX[2][deviceIndex] },
            { min: 200, max: 300, lowerScore: SCORE_MATRIX[2][deviceIndex], upperScore: SCORE_MATRIX[3][deviceIndex] },
            { min: 300, max: 400, lowerScore: SCORE_MATRIX[3][deviceIndex], upperScore: SCORE_MATRIX[4][deviceIndex] },
            { min: 400, max: 600, lowerScore: SCORE_MATRIX[4][deviceIndex], upperScore: SCORE_MATRIX[5][deviceIndex] },
            { min: 600, max: 800, lowerScore: SCORE_MATRIX[5][deviceIndex], upperScore: SCORE_MATRIX[6][deviceIndex] },
            { min: 800, max: 1000, lowerScore: SCORE_MATRIX[6][deviceIndex], upperScore: SCORE_MATRIX[7][deviceIndex] },
            { min: 1000, max: 1300, lowerScore: SCORE_MATRIX[7][deviceIndex], upperScore: SCORE_MATRIX[8][deviceIndex] }
        ];
        
        for (let range of ranges) {
            if (weight > range.min && weight <= range.max) {
                const ratio = (weight - range.min) / (range.max - range.min);
                const result = range.lowerScore + ratio * (range.upperScore - range.lowerScore);
                return result;
            }
        }
        
        // Ø§Ú¯Ø± ÙˆØ²Ù† Ø¨ÛŒØ´ØªØ± Ø§Ø² 1300 Ø¨Ø§Ø´Ø¯
        return SCORE_MATRIX[9][deviceIndex];
    }

    function calcDeviceWeightScore() {
        const deviceSelected = document.querySelector('.selectable-cell.selected[data-group="device"]'); 
        const finalScoreElement = document.getElementById('finalScore');
        let finalScore = null;

        if (!deviceSelected) {
            finalScoreElement.textContent = "Ø§Ù…ØªÛŒØ§Ø² ÙˆØ³ÛŒÙ„Ù‡ Ã— ÙˆØ²Ù†: â€”";
            calculateFinalScore();
            return;
        }

        const deviceIndex = parseInt(deviceSelected.dataset.value) - 1; 
        const weightCustom = parseFloat(document.getElementById('weightCustom').value);
        
        if (!isNaN(weightCustom) && weightCustom > 0) {
            finalScore = interpolateScore(weightCustom, deviceIndex);
        } else {
            const weightSelect = document.getElementById('weightRange');
            const selectedIndex = weightSelect.selectedIndex;
            
            if (selectedIndex > 0) {
                const rowIndex = selectedIndex - 1;
                if (rowIndex >= 0 && rowIndex < SCORE_MATRIX.length) {
                    finalScore = SCORE_MATRIX[rowIndex][deviceIndex];
                }
            }
        }

        if (finalScore !== null) {
            finalScoreElement.textContent = `Ø§Ù…ØªÛŒØ§Ø² ÙˆØ³ÛŒÙ„Ù‡ Ã— ÙˆØ²Ù†: ${finalScore.toFixed(2)}`;
        } else {
            finalScoreElement.textContent = 'Ø§Ù…ØªÛŒØ§Ø² ÙˆØ³ÛŒÙ„Ù‡ Ã— ÙˆØ²Ù†: â€”';
        }
        
        calculateFinalScore();
    }

    // ---------------------- Time/Distance Interpolation Functions ----------------------

    const distanceThresholds = [40, 200, 400, 800, 1200, 1800, 2500, 4200, 6300, 8400, 11000, 15000, 20000];
    const distanceScores = [1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10];
    const durationThresholds = [1, 5, 10, 20, 30, 45, 60, 100, 150, 210, 270, 360, 480];
    const durationScores = [1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10];

    function interpolateByThreshold(val, thresholds, scores) {
        if (val == null || isNaN(val) || val <= 0) return null;
        
        if (val <= thresholds[0]) return scores[0];
        
        for (let i = 1; i < thresholds.length; i++) {
            if (val <= thresholds[i]) {
                const prevThreshold = thresholds[i - 1];
                const currentThreshold = thresholds[i];
                const prevScore = scores[i - 1];
                const currentScore = scores[i];
                
                const ratio = (val - prevThreshold) / (currentThreshold - prevThreshold);
                return prevScore + ratio * (currentScore - prevScore);
            }
        }
        
        return scores[scores.length - 1];
    }

    // ---------------------- General Utility Functions ----------------------

    function extractScore(elementId) {
      const text = document.getElementById(elementId)?.textContent || '';
      const match = text.match(/[\d\.]+/);
      return match ? parseFloat(match[0]) : 0;
    }

    // ---------------------- General Cell Selection Handler ----------------------
    function handleCellSelection(event) {
        const targetCell = event.currentTarget;
        const group = targetCell.dataset.group;
        if (!group) return; 
        
        if (targetCell.classList.contains('temp-disabled')) {
            return;
        }
        
        const isMultiSelect = targetCell.classList.contains('multi-select');
        const isPathCell = group === 'path';
        
        // ** Ø§Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 4 Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø§Ù… 4 Ùˆ 5 **
        if (group === 'unfavorable' || group === 'device-bad') {
            const isAdding = !targetCell.classList.contains('selected');
            const isNoneOption = targetCell.classList.contains('none-option');

            if (isMultiSelect && isAdding && !isNoneOption) {
                let currentScore = 0;
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² ÙØ¹Ù„ÛŒ Ø¨Ø¯ÙˆÙ† Ø§Ø­ØªØ³Ø§Ø¨ Ø¢ÛŒØªÙ… Ø¯Ø± Ø­Ø§Ù„ Ú©Ù„ÛŒÚ©
                document.querySelectorAll(`.selectable-cell.selected[data-group="${group}"]`).forEach(cell => {
                    if (cell !== targetCell) {
                        currentScore += parseFloat(cell.dataset.score);
                    }
                });

                const newScore = currentScore + parseFloat(targetCell.dataset.score);
                if (newScore > 4) {
                    alert(`Ø®Ø·Ø§: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú¯Ø§Ù… (Ú¯Ø§Ù… ${group === 'unfavorable' ? 'Ú†Ù‡Ø§Ø±Ù…' : 'Ù¾Ù†Ø¬Ù…'}) Ù†Ø¨Ø§ÛŒØ¯ Ø§Ø² 4 Ø¨ÛŒØ´ØªØ± Ø´ÙˆØ¯. Ù„Ø·ÙØ§ Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§Ø²Ø¨ÛŒÙ†ÛŒ Ú©Ù†ÛŒØ¯.`);
                    event.preventDefault(); 
                    return; 
                }
            }
        }
        // ** Ù¾Ø§ÛŒØ§Ù† Ø§Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª **

        if (isMultiSelect) {
            // Handle multi-select groups (unfavorable, device-bad)
            const isNoneOption = targetCell.classList.contains('none-option');

            if (isNoneOption && targetCell.classList.contains('selected')) {
                // If none option is clicked while selected, do nothing
                return;
            } else if (isNoneOption) {
                // If none option is selected, deselect all others
                document.querySelectorAll(`.selectable-cell[data-group="${group}"]`).forEach(cell => {
                    cell.classList.remove('selected');
                });
                targetCell.classList.add('selected');
            } else {
                // If regular option is clicked, deselect none option and toggle this one
                document.querySelector(`.selectable-cell[data-group="${group}"].none-option`)?.classList.remove('selected');
                targetCell.classList.toggle('selected');
            }
        } else if (isPathCell) {
            // Handle path table - single selection for entire table
            document.querySelectorAll('.selectable-cell[data-group="path"]').forEach(cell => {
                cell.classList.remove('selected');
            });
            targetCell.classList.add('selected');
        } else {
            // Handle single-select groups
            const isSelected = targetCell.classList.contains('selected');
            
            document.querySelectorAll(`.selectable-cell[data-group="${group}"]`).forEach(cell => {
                cell.classList.remove('selected');
            });
            
            if (!isSelected) {
                if (group === 'posture') {
                    const row = targetCell.closest('tr');
                    row.querySelector('.posture-image-cell').classList.add('selected');
                    row.querySelector('td:nth-child(2)').classList.add('selected'); 
                } else {
                    targetCell.classList.add('selected');
                }
            }
        }

        switch (group) {
            case 'time-distance':
            case 'time-duration':
                calcTimeScore();
                break;
            case 'device':
                calcDeviceWeightScore();
                break;
            case 'path':
            case 'slope':
                calcPathSlopeScore();
                break;
            case 'unfavorable':
                updateUnfavorableScore();
                break;
            case 'device-bad':
                updateDeviceBadScore();
                break;
            case 'posture':
                updatePostureScore();
                break;
            case 'variety':
                updateVarietyScore();
                break;
        }
    }

    function calcTimeScore() {
        const mode = document.querySelector('input[name="mode"]:checked')?.value || 'distance';
        let score = null;
        
        if (mode === 'distance') {
            const custom = parseFloat(document.getElementById('distanceCustom').value);
            const selectedCell = document.querySelector('.selectable-cell.selected[data-group="time-distance"]');
            
            if (!isNaN(custom) && custom > 0) {
                score = interpolateByThreshold(custom, distanceThresholds, distanceScores);
            } else if (selectedCell) {
                score = Number(selectedCell.dataset.score);
            }
        } else {
            const custom = parseFloat(document.getElementById('durationCustom').value);
            const selectedCell = document.querySelector('.selectable-cell.selected[data-group="time-duration"]');

            if (!isNaN(custom) && custom > 0) {
                score = interpolateByThreshold(custom, durationThresholds, durationScores);
            } else if (selectedCell) {
                score = Number(selectedCell.dataset.score);
            }
        }
        
        const timeScoreElement = document.getElementById('timeScore');
        if (score !== null) {
            timeScoreElement.textContent = `Ø§Ù…ØªÛŒØ§Ø² Ø²Ù…Ø§Ù† (Ø¶Ø±ÛŒØ¨): ${score.toFixed(2)}`;
        } else {
            timeScoreElement.textContent = 'Ø§Ù…ØªÛŒØ§Ø² Ø²Ù…Ø§Ù† (Ø¶Ø±ÛŒØ¨): â€”';
        }
        calculateFinalScore();
    }

    function toggleTimeMode() {
        const mode = document.querySelector('input[name="mode"]:checked')?.value || 'distance';
        document.getElementById('distanceWrap').style.display = (mode === 'distance') ? 'block' : 'none';
        document.getElementById('durationWrap').style.display = (mode === 'duration') ? 'block' : 'none';
        if (mode === 'distance') {
             document.querySelectorAll('.selectable-cell[data-group="time-duration"]').forEach(cell => cell.classList.remove('selected'));
             document.getElementById('durationCustom').value = '';
        } else {
             document.querySelectorAll('.selectable-cell[data-group="time-distance"]').forEach(cell => cell.classList.remove('selected'));
             document.getElementById('distanceCustom').value = '';
        }

        calcTimeScore();
    }
    
    function calcPathSlopeScore() {
        let pathSum = 0;
        const selectedPathCell = document.querySelector('.selectable-cell.selected[data-group="path"]');
        if (selectedPathCell) {
            pathSum = Number(selectedPathCell.dataset.score);
        }
        
        const slopeSelected = document.querySelector('.selectable-cell.selected[data-group="slope"]');
        const slopeScore = slopeSelected ? Number(slopeSelected.dataset.score) : 0; 
        
        const total = pathSum + slopeScore;
        document.getElementById('pathSlopeScore').textContent = `Ø§Ù…ØªÛŒØ§Ø² Ù…Ø³ÛŒØ± + Ø´ÛŒØ¨/Ù¾Ù„Ù‡: ${total.toFixed(2)}`;
        calculateFinalScore();
    }
    
    // ** Ø§ØµÙ„Ø§Ø­ Ø§Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 4 Ø§Ù…ØªÛŒØ§Ø²ÛŒ **
    function updateUnfavorableScore() {
        let score = 0;
        document.querySelectorAll('.selectable-cell.selected[data-group="unfavorable"]').forEach(cell => {
            score += parseFloat(cell.dataset.score);
        });
        
        const finalScore = Math.min(score, 4); // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± 4
        
        document.getElementById('unfavorableScore').textContent = `Ø§Ù…ØªÛŒØ§Ø² Ø´Ø±Ø§ÛŒØ· Ù†Ø§Ù…Ø·Ù„ÙˆØ¨: ${finalScore.toFixed(2)}`;
        calculateFinalScore();
    }

    // ** Ø§ØµÙ„Ø§Ø­ Ø§Ø¹Ù…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 4 Ø§Ù…ØªÛŒØ§Ø²ÛŒ **
    function updateDeviceBadScore() {
        let score = 0;
        document.querySelectorAll('.selectable-cell.selected[data-group="device-bad"]').forEach(cell => {
            score += parseFloat(cell.dataset.score);
        });
        
        const finalScore = Math.min(score, 4); // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø§Ù…ØªÛŒØ§Ø² Ø¨Ù‡ Ø­Ø¯Ø§Ú©Ø«Ø± 4
        
        document.getElementById('deviceBadScore').textContent = `Ø§Ù…ØªÛŒØ§Ø² ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø·Ù„ÙˆØ¨ ÙˆØ³ÛŒÙ„Ù‡: ${finalScore.toFixed(2)}`;
        calculateFinalScore();
    }
    
    function updatePostureScore() {
        const selected = document.querySelector('.selectable-cell.selected[data-group="posture"]');
        const score = selected ? Number(selected.dataset.score) : 0; 
        document.getElementById('postureScore').textContent = `Ø§Ù…ØªÛŒØ§Ø² Ù¾ÙˆØ³Ú†Ø±: ${score.toFixed(2)}`;
        calculateFinalScore();
    }

    function updateVarietyScore() {
        const selected = document.querySelector('.selectable-cell.selected[data-group="variety"]');
        const score = selected ? Number(selected.dataset.score) : 0;
        document.getElementById('varietyScore').textContent = `Ø§Ù…ØªÛŒØ§Ø² ØªÙ†ÙˆØ¹ ÙˆØ¸Ø§ÛŒÙ: ${score.toFixed(2)}`;
        calculateFinalScore();
    }

    function highlightRiskRow(finalScore) {
        const rows = document.querySelectorAll('#riskTable tbody tr');
        rows.forEach(row => {
            row.className = '';
            const min = parseFloat(row.dataset.min);
            const max = parseFloat(row.dataset.max);
            const riskLevel = row.dataset.risk;

            if (finalScore >= min && finalScore <= max) {
                if (riskLevel === '1') row.classList.add('risk-low'); 
                else if (riskLevel === '2') row.classList.add('risk-slight'); 
                else if (riskLevel === '3') row.classList.add('risk-high'); 
                else if (riskLevel === '4') row.classList.add('risk-very-high'); 
            }
        });
    }
    
    // ---------------------- Final Score Calculation ----------------------
    
    function calculateFinalScore() {
      // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ extractScore Ú©Ù‡ Ø®Ø±ÙˆØ¬ÛŒ Ø¢Ù† Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ù‡ 4 Ù…Ø­Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª
      const deviceWeight = extractScore('finalScore');
      const pathSlope = extractScore('pathSlopeScore');
      const unfavorable = extractScore('unfavorableScore');
      const deviceBad = extractScore('deviceBadScore');
      const posture = extractScore('postureScore');
      const variety = extractScore('varietyScore');
      const timeScore = extractScore('timeScore'); 

      const indexSum = unfavorable + deviceBad + posture + variety + deviceWeight + pathSlope; // ØªØ±ØªÛŒØ¨ Ø¬Ù…Ø¹ Ù…Ù‡Ù… Ù†ÛŒØ³Øª
      
      let finalScore = indexSum * timeScore;

      if (document.getElementById('twoPerson').checked) {
        finalScore *= 0.7;
      }
      if (document.getElementById('female').checked) {
        finalScore *= 1.3;
      }

      document.getElementById('scoreDeviceWeight').textContent = deviceWeight.toFixed(2);
      document.getElementById('scorePathSlope').textContent = pathSlope.toFixed(2);
      document.getElementById('scoreUnfavorable').textContent = unfavorable.toFixed(2);
      document.getElementById('scoreDeviceBad').textContent = deviceBad.toFixed(2);
      document.getElementById('scorePosture').textContent = posture.toFixed(2);
      document.getElementById('scoreVariety').textContent = variety.toFixed(2);
      
      document.getElementById('scoreIndex').textContent = indexSum.toFixed(2);
      document.getElementById('scoreTimeFinal').textContent = timeScore.toFixed(2);
      document.getElementById('finalActivityScore').textContent = finalScore.toFixed(2);
      
      highlightRiskRow(finalScore);
    }

    // ---------------------- Print Function (FIXED FOR DENSITY) ----------------------
    function printFinalResults() {
        // 1. Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ø§Ø¹Ù…Ø§Ù„ Ø¢Ø®Ø±ÛŒÙ† Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ùˆ Ù‡Ø§ÛŒÙ„Ø§ÛŒØªâ€ŒÙ‡Ø§
        if (typeof calculateFinalScore === 'function') calculateFinalScore();
        
        const currentDate = new Date().toLocaleDateString('fa-IR');
        const location = document.getElementById('location')?.value || '---';
        const evaluator = document.getElementById('evaluator')?.value || '---';

        // 2. Ú©Ù¾ÛŒ Ùˆ Ø§ØµÙ„Ø§Ø­ Ú¯Ø§Ù… 8 Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØµØ­ÛŒØ­ ÙˆØ¶Ø¹ÛŒØª Ú†Ú©â€ŒØ¨Ø§Ú©Ø³â€ŒÙ‡Ø§
        const step8Element = document.getElementById('step8');
        const step8Clone = step8Element ? step8Element.cloneNode(true) : null;
        let step8HTML = '';

        if (step8Clone) {
            const inlineDiv = step8Clone.querySelector('.inline');
            if (inlineDiv) {
                const isTwoPersonChecked = document.getElementById('twoPerson').checked;
                const isFemaleChecked = document.getElementById('female').checked;
                
                // Ù…ØªÙ† Ø§ØµÙ„ÛŒ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                const twoPersonText = 'Ú©Ø´ÛŒØ¯Ù† ÛŒØ§ Ù‡Ù„ Ø¯Ø§Ø¯Ù† Ø¯Ùˆ Ù†ÙØ±Ù‡ (Ã—0.7)';
                const femaleText = 'Ø§Ú¯Ø± Ø®Ø§Ù†Ù… Ø¨Ø§Ø´Ø¯ (Ã—1.3)';

                // Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ú†Ø§Ù¾ Ù‚Ø§Ø¨Ù„ Ø§Ø¹ØªÙ…Ø§Ø¯
                const twoPersonSymbol = isTwoPersonChecked ? 'â˜‘' : 'â˜';
                const femaleSymbol = isFemaleChecked ? 'â˜‘' : 'â˜';
                
                // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ inline Ø¨Ø§ Ù†Ù…Ø§Ø¯Ù‡Ø§ÛŒ Ù…ØªÙ†ÛŒ
                inlineDiv.innerHTML = `
                    <div style="font-weight: bold; background-color: #f0f0f0; padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">${twoPersonSymbol} ${twoPersonText}</div>
                    <div style="font-weight: bold; background-color: #f0f0f0; padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">${femaleSymbol} ${femaleText}</div>
                `;
                
                // Ø§Ø¹Ù…Ø§Ù„ Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ div inline Ø¯Ø± Ú©Ù¾ÛŒ
                inlineDiv.style.cssText = 'margin-top:20px; display:flex; justify-content: start; gap: 20px;';
            }
            step8HTML = step8Clone.outerHTML;
        }
        
        // 3. Ú¯Ø±ÙØªÙ† HTML Ú¯Ø§Ù… 9
        const step9HTML = document.getElementById('step9')?.outerHTML || '';
        
        // 4. Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù¾Ù†Ø¬Ø±Ù‡ Ù¾Ø±ÛŒÙ†Øª Ùˆ Ù†ÙˆØ´ØªÙ† Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
        const w = window.open('', '_blank');
        w.document.write(`<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
<meta charset="UTF-8">
<title>Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ KIM-PP-Fa</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
<style>
  /* Ø§ØµÙ„Ø§Ø­ Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø± Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ù‡ Ú†Ø§Ù¾ Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ */
  * {
    -webkit-print-color-adjust: exact !important; 
    print-color-adjust: exact !important;
  }
  body{font-family:Vazirmatn, Tahoma, sans-serif;direction:rtl;margin:5px;line-height:1.4;color:#333; font-size: 12px;}
  .print-header{text-align:center;border-bottom:2px solid #007bff;padding-bottom:5px;margin-bottom:10px;}
  .print-header h2{color:#007bff;margin:0 0 3px 0; font-size: 18px;}
  table{width:100%;border-collapse:collapse;margin:5px 0;page-break-inside:avoid;}
  th,td{border:1px solid #333;padding:4px 6px;text-align:right;vertical-align:top;}
  th{background:#f0f0f0;font-weight:700;}
  /* Ø±Ù†Ú¯ Ø±ÛŒØ³Ú© - ØªÚ©Ø±Ø§Ø± Ø¨Ø±Ø§ÛŒ Ù…Ø­ÛŒØ· Ù¾Ø±ÛŒÙ†Øª */
  .risk-low{background-color:#00cc44 !important;}
  .risk-slight{background-color:#ffff66 !important;}
  .risk-high{background-color:#ff9933 !important;}
  .risk-very-high{background-color:#ff3333 !important;}
  .total { background:#f0f0f0 !important; }
  .final { background:#e9f5ff !important; color:#007bff !important; }
  #riskTable th, #riskTable td { font-size: 11px; } /* Smallest font for the table */
  h3 { margin-top: 10px; font-size: 14px; padding-bottom: 5px; border-bottom: 1px solid #333; }
</style>
</head>
<body>
  <div class="print-header">
    <h2>Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ KIM-PP-Fa</h2>
    <div>${'ØªØ§Ø±ÛŒØ®: '+currentDate+' | Ù…Ø­Ù„: '+location+' | Ø§Ø±Ø²ÛŒØ§Ø¨: '+evaluator}</div>
  </div>
  ${step8HTML}
  ${step9HTML}
  <script>window.onload=function(){
    window.print();
    setTimeout(function(){window.close();},300);
  };<\/script>
</body>
</html>`);
        w.document.close();
    }
    
    // ===== ØªÙˆØ§Ø¨Ø¹ Ø§Ø¶Ø§ÙÛŒ Ø¬Ù‡Øª Ø¨Ù‡Ø¨ÙˆØ¯ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ =====
    
    // Ú©Ù…Ú©â€ŒÚ©Ø§Ø±: Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯Ùˆ Ú¯Ø²ÛŒÙ†Ù‡ ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§ÛŒ Ù…Ú©Ø±Ø±
    function getMutualStopCells(){
      const cells = Array.from(document.querySelectorAll('.selectable-cell[data-group="unfavorable"]'));
      let noBrake=null, withBrake=null;
      cells.forEach(c=>{
        const t=(c.textContent||'').replace(/\s+/g,'').trim();
        if(t.includes('ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§ÛŒÙ…Ú©Ø±Ø±:Ø¨Ø¯ÙˆÙ†ØªØ±Ù…Ø²Ú¯ÛŒØ±ÛŒ')) noBrake=c;
        if(t.includes('ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§ÛŒÙ…Ú©Ø±Ø±:Ø¨Ø§ØªØ±Ù…Ø²Ú¯ÛŒØ±ÛŒ')) withBrake=c;
      });
      return {noBrake, withBrake};
    }

    // Ø§Ù†Ø­ØµØ§Ø± Ú©Ø§Ù…Ù„: Ø§Ú¯Ø± ÛŒÚ©ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø´ÙˆØ¯ØŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    function setupMutualStops(){
      const {noBrake, withBrake} = getMutualStopCells();
      if(!noBrake || !withBrake) return;
      [noBrake, withBrake].forEach(cell=>{
        cell.addEventListener('click', function(){
          setTimeout(function(){
            const nbSel=noBrake.classList.contains('selected');
            const wbSel=withBrake.classList.contains('selected');
            if(nbSel && wbSel){
              // Ù…ÙˆØ±Ø¯ Ø§Ø®ÛŒØ± Ø¨Ø§Ù‚ÛŒ Ø¨Ù…Ø§Ù†Ø¯
              if(cell===noBrake){ withBrake.classList.remove('selected'); }
              else { noBrake.classList.remove('selected'); }
            }else if(nbSel){
              withBrake.classList.remove('selected');
            }else if(wbSel){
              noBrake.classList.remove('selected');
            }
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù…ØªÛŒØ§Ø²
            if(typeof updateUnfavorableScore==='function') updateUnfavorableScore();
            if(typeof calculateFinalScore==='function') calculateFinalScore();
            // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙÛŒ Ø±Ø§ Ù†ÛŒØ² Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒÙ…
            applyRowHighlights();
          },0);
        });
      });
    }

    // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ú©Ù„ Ø±Ø¯ÛŒÙ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ù‡Ø¯Ù
    function applyRowHighlights(){
      // Ú¯Ø§Ù… Ø³ÙˆÙ… ÙÙ‚Ø· Ø¬Ø¯ÙˆÙ„ Ø´ÛŒØ¨/Ù¾Ù„Ù‡ (group='slope') â€” ØªÚ©â€ŒØ§Ù†ØªØ®Ø§Ø¨
      document.querySelectorAll('table .selectable-cell[data-group="slope"]').forEach(cell=>{
        const tr=cell.closest('tr');
        if(!tr) return;
        const selected = tr.querySelector('.selectable-cell[data-group="slope"].selected');
        tr.classList.toggle('row-selected', !!selected);
        // Ø§Ø¬Ø§Ø²Ù‡ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ú©Ù„ Ø±Ø¯ÛŒÙ
        tr.style.cursor='pointer';
        tr.addEventListener('click', function(e){
          if(!(e.target && e.target.classList && e.target.classList.contains('selectable-cell'))){
            // Ø§Ú¯Ø± Ø±ÙˆÛŒ Ø¬Ø§ÛŒ Ø¯ÛŒÚ¯Ø±ÛŒ Ø§Ø² Ø±Ø¯ÛŒÙ Ú©Ù„ÛŒÚ© Ø´Ø¯ØŒ Ø§ÙˆÙ„ÛŒÙ† Ø³Ù„ÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ù‡Ù…Ø§Ù† Ø±Ø¯ÛŒÙ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨/ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡
            const targetCell = tr.querySelector('.selectable-cell[data-group="slope"]');
            if(targetCell){ targetCell.click(); }
          }
        });
      });

      // Ú¯Ø§Ù… Ú†Ù‡Ø§Ø±Ù… ØªØ§ Ù‡ÙØªÙ…: Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ú†Ù†Ø¯/ØªÚ©â€ŒØ§Ù†ØªØ®Ø§Ø¨ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø±Ø¯ÛŒÙ Ú©Ø§Ù…Ù„ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø´ÙˆØ¯
      const rowGroups=['unfavorable','device-bad','posture','variety'];
      rowGroups.forEach(g=>{
        document.querySelectorAll(`table .selectable-cell[data-group="${g}"]`).forEach(cell=>{
          const tr=cell.closest('tr');
          if(!tr) return;
          const anySelected = tr.querySelector(`.selectable-cell[data-group="${g}"].selected`);
          tr.classList.toggle('row-selected', !!anySelected);
          // Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ø±Ø¯ÛŒÙ
          tr.style.cursor='pointer';
          tr.addEventListener('click', function(e){
            if(!(e.target && e.target.classList && e.target.classList.contains('selectable-cell'))){
              // Ø¨Ø±Ø§ÛŒ posture (ØªÚ©â€ŒØ§Ù†ØªØ®Ø§Ø¨ Ú©Ù„ Ø¬Ø¯ÙˆÙ„): Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ø§Ù† Ø±Ø¯ÛŒÙ
              if(g==='posture'){
                // Ù¾Ø§Ú©â€ŒÚ©Ø±Ø¯Ù† Ø§Ù†ØªØ®Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                document.querySelectorAll(`.selectable-cell[data-group="${g}"]`).forEach(c=>c.classList.remove('selected'));
                // Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ù…Ù‡ Ø³Ù„ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø¯Ù‡ Ø§ÛŒÙ† Ø±Ø¯ÛŒÙ Ú©Ù‡ Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù‡Ø³ØªÙ†Ø¯
                tr.querySelectorAll(`.selectable-cell[data-group="${g}"]`).forEach(c=>c.classList.add('selected'));
                if(typeof updatePostureScore==='function') updatePostureScore();
              }else if(g==='variety' || g==='slope'){
                // ØªÚ©â€ŒØ§Ù†ØªØ®Ø§Ø¨
                document.querySelectorAll(`.selectable-cell[data-group="${g}"]`).forEach(c=>c.classList.remove('selected'));
                tr.querySelectorAll(`.selectable-cell[data-group="${g}"]`).forEach(c=>c.classList.add('selected'));
                if(g==='variety' && typeof updateVarietyScore==='function') updateVarietyScore();
              }else{
                // unfavorable / device-bad (Ú†Ù†Ø¯â€ŒØ§Ù†ØªØ®Ø§Ø¨ÛŒ): toggle
                const firstCell = tr.querySelector(`.selectable-cell[data-group="${g}"]`);
                if(firstCell){
                  firstCell.classList.toggle('selected');
                  if(g==='unfavorable' && typeof updateUnfavorableScore==='function') updateUnfavorableScore();
                  if(g==='device-bad' && typeof updateDeviceBadScore==='function') updateDeviceBadScore();
                }
              }
              if(typeof calculateFinalScore==='function') calculateFinalScore();
              // Ù¾Ø³ Ø§Ø² ØªØºÛŒÛŒØ± Ø§Ù†ØªØ®Ø§Ø¨ØŒ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙÛŒ Ø±Ø§ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù†ÛŒÙ…
              setTimeout(applyRowHighlights,0);
            }
          });
        });
      });
    }

    // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„
    function resetForm(){
      try{
        document.querySelectorAll('input[type=text],input[type=number]').forEach(el=>el.value='');
        document.querySelectorAll('select').forEach(el=>el.selectedIndex=0);
        document.querySelectorAll('.selectable-cell').forEach(cell=>cell.classList.remove('selected','temp-disabled'));
        document.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false);
        document.querySelectorAll('.score-box').forEach(el=>el.textContent='â€”');
        ['scoreDeviceWeight','scorePathSlope','scoreUnfavorable','scoreDeviceBad','scorePosture','scoreVariety','scoreIndex','scoreTimeFinal','finalActivityScore']
          .forEach(id=>{const el=document.getElementById(id); if(el) el.textContent='â€”';});
        document.querySelectorAll('#riskTable tbody tr').forEach(r=>r.className='');
        document.querySelectorAll('tr.row-selected').forEach(r=>r.classList.remove('row-selected'));
        if(typeof calculateFinalScore==='function') calculateFinalScore();
        setTimeout(function(){ applyRowHighlights(); },0);
      }catch(e){ console.error(e); }
    }

    // ---------------------- Initialization ----------------------

    function init() {
        populateShamsiDate();
        
        document.querySelectorAll('input[name="mode"]').forEach(r => r.addEventListener('change', toggleTimeMode));
        document.getElementById('distanceCustom').addEventListener('input', calcTimeScore);
        document.getElementById('durationCustom').addEventListener('input', calcTimeScore);
        toggleTimeMode();

        document.getElementById('weightRange').addEventListener('change', calcDeviceWeightScore);
        document.getElementById('weightCustom').addEventListener('input', calcDeviceWeightScore);
        
        document.querySelectorAll('.selectable-cell').forEach(cell => {
            cell.addEventListener('click', handleCellSelection);
        });
        
        document.getElementById('twoPerson').addEventListener('change', calculateFinalScore);
        document.getElementById('female').addEventListener('change', calculateFinalScore);

        calcDeviceWeightScore();
        calcPathSlopeScore();
        updateUnfavorableScore(); 
        updateDeviceBadScore();
        updatePostureScore(); 
        updateVarietyScore();
        
        calculateFinalScore();
    }

    document.addEventListener('DOMContentLoaded', init);
    document.addEventListener('DOMContentLoaded', function(){
      try{
        // Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
        var btn = document.getElementById('resetForm');
        if(btn) btn.addEventListener('click', resetForm);
        // Ø§Ù†Ø­ØµØ§Ø± ØªÙˆÙ‚Ùâ€ŒÙ‡Ø§
        setupMutualStops();
        // Ù‡Ø§ÛŒÙ„Ø§ÛŒØª Ø±Ø¯ÛŒÙÛŒ
        setTimeout(applyRowHighlights,0);
      }catch(e){ console.error(e); }
    });
</script>
</body>
</html>
